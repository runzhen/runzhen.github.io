<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>TLS 1.2 协议格式 | Mind in the Wind</title>
<meta name=keywords content="tls"><meta name=description content="本文内容来自《Traffic Analysis of an SSL/TLS Session》的阅读笔记，原文见此处。
TLS 全称为 Transport Layer Security，它本身也分为了 Lower 和 Higher 两层协议。
Lower Layer Lower Layer 协议在 TCP 协议之上，提供面向连接的可靠传输，在这一层的协议主要是记录协议（TLS Record Protocol）。 记录协议首先把上层协议传来的数据分成小于2^14字节的数据块，如果设置了压缩选项，则第二步为压缩数据，然后在数据块的末尾增加 MAC（Message Authentication Code），第三步将数据块加密，最后增加记录头。该过程如下所示。
each block is packed into a structure that does not preserve client message boundaries, meaning that mulitiple message of the same type maybe coalesced into a single structure
-----------+ data --+--------------> 1. Fragment data -----------+ +------------------------+ | | | | +------------------------+ 2. Compress data (generally no compression applied) +------------------------+----+ | |MAC | Add a Message Authentication Code | | | +------------------------+----+ 3."><meta name=author content="Me"><link rel=canonical href=https://runzhen.github.io/posts/tls-basic/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.103f87022495ee8537d399aa50bf7e2203f4c653b709467478c7fd5a58182364.css integrity="sha256-ED+HAiSV7oU305mqUL9+IgP0xlO3CUZ0eMf9WlgYI2Q=" rel="preload stylesheet" as=style><link rel=icon href=https://runzhen.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://runzhen.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://runzhen.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://runzhen.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://runzhen.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://runzhen.github.io/posts/tls-basic/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="TLS 1.2 协议格式"><meta property="og:description" content="本文内容来自《Traffic Analysis of an SSL/TLS Session》的阅读笔记，原文见此处。
TLS 全称为 Transport Layer Security，它本身也分为了 Lower 和 Higher 两层协议。
Lower Layer Lower Layer 协议在 TCP 协议之上，提供面向连接的可靠传输，在这一层的协议主要是记录协议（TLS Record Protocol）。 记录协议首先把上层协议传来的数据分成小于2^14字节的数据块，如果设置了压缩选项，则第二步为压缩数据，然后在数据块的末尾增加 MAC（Message Authentication Code），第三步将数据块加密，最后增加记录头。该过程如下所示。
each block is packed into a structure that does not preserve client message boundaries, meaning that mulitiple message of the same type maybe coalesced into a single structure
-----------+ data --+--------------> 1. Fragment data -----------+ +------------------------+ | | | | +------------------------+ 2. Compress data (generally no compression applied) +------------------------+----+ | |MAC | Add a Message Authentication Code | | | +------------------------+----+ 3."><meta property="og:type" content="article"><meta property="og:url" content="https://runzhen.github.io/posts/tls-basic/"><meta property="og:image" content="https://runzhen.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-06-18T00:00:00+00:00"><meta property="article:modified_time" content="2016-06-18T00:00:00+00:00"><meta property="og:site_name" content="Mind in the Wind"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://runzhen.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="TLS 1.2 协议格式"><meta name=twitter:description content="本文内容来自《Traffic Analysis of an SSL/TLS Session》的阅读笔记，原文见此处。
TLS 全称为 Transport Layer Security，它本身也分为了 Lower 和 Higher 两层协议。
Lower Layer Lower Layer 协议在 TCP 协议之上，提供面向连接的可靠传输，在这一层的协议主要是记录协议（TLS Record Protocol）。 记录协议首先把上层协议传来的数据分成小于2^14字节的数据块，如果设置了压缩选项，则第二步为压缩数据，然后在数据块的末尾增加 MAC（Message Authentication Code），第三步将数据块加密，最后增加记录头。该过程如下所示。
each block is packed into a structure that does not preserve client message boundaries, meaning that mulitiple message of the same type maybe coalesced into a single structure
-----------+ data --+--------------> 1. Fragment data -----------+ +------------------------+ | | | | +------------------------+ 2. Compress data (generally no compression applied) +------------------------+----+ | |MAC | Add a Message Authentication Code | | | +------------------------+----+ 3."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://runzhen.github.io/posts/"},{"@type":"ListItem","position":2,"name":"TLS 1.2 协议格式","item":"https://runzhen.github.io/posts/tls-basic/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"TLS 1.2 协议格式","name":"TLS 1.2 协议格式","description":"本文内容来自《Traffic Analysis of an SSL/TLS Session》的阅读笔记，原文见此处。\nTLS 全称为 Transport Layer Security，它本身也分为了 Lower 和 Higher 两层协议。\nLower Layer Lower Layer 协议在 TCP 协议之上，提供面向连接的可靠传输，在这一层的协议主要是记录协议（TLS Record Protocol）。 记录协议首先把上层协议传来的数据分成小于2^14字节的数据块，如果设置了压缩选项，则第二步为压缩数据，然后在数据块的末尾增加 MAC（Message Authentication Code），第三步将数据块加密，最后增加记录头。该过程如下所示。\neach block is packed into a structure that does not preserve client message boundaries, meaning that mulitiple message of the same type maybe coalesced into a single structure\n-----------+ data --+--------------\u0026gt; 1. Fragment data -----------+ +------------------------+ | | | | +------------------------+ 2. Compress data (generally no compression applied) +------------------------+----+ | |MAC | Add a Message Authentication Code | | | +------------------------+----+ 3.","keywords":["tls"],"articleBody":"本文内容来自《Traffic Analysis of an SSL/TLS Session》的阅读笔记，原文见此处。\nTLS 全称为 Transport Layer Security，它本身也分为了 Lower 和 Higher 两层协议。\nLower Layer Lower Layer 协议在 TCP 协议之上，提供面向连接的可靠传输，在这一层的协议主要是记录协议（TLS Record Protocol）。 记录协议首先把上层协议传来的数据分成小于2^14字节的数据块，如果设置了压缩选项，则第二步为压缩数据，然后在数据块的末尾增加 MAC（Message Authentication Code），第三步将数据块加密，最后增加记录头。该过程如下所示。\neach block is packed into a structure that does not preserve client message boundaries, meaning that mulitiple message of the same type maybe coalesced into a single structure\n-----------+ data --+--------------\u003e 1. Fragment data -----------+ +------------------------+ | | | | +------------------------+ 2. Compress data (generally no compression applied) +------------------------+----+ | |MAC | Add a Message Authentication Code | | | +------------------------+----+ 3. Encrypt data +-----------------------------+ |ciphertext | | | +-----------------------------+ 4. Add header +----+-----------------------------+ TLS Record | |ciphertext | Add a TLS Record header header | | | +----+-----------------------------+ Higher Layer 主要有四种协议。\n握手协议（Handshake Protocol）建立通信。 密钥交换协议（ChangeCipherSpec Protocol）让之前协商好的协议生效，此时通信加密。 警告协议（Alter Protocol）通信出现异常时使用，提示用户潜在的安全问题。 程序数据协议（Application Data Protocol）数据通信。 握手的过程如下所示。\nTLS Handshake +-----+ +-----+ | | | | | | ClientHello | | | o----------------------------\u003e | | | | | | CLIENT | | ServerHello | | SERVER | | [Certificate] | | | | [ServerKeyExchange] | | | | [CertificateRequest] | | | | ServerHelloDone | | | | \u003c----------------------------o | | | | | | | [Certificate] | | | | ClientKeyExchange | | | | [CertificateVerify] | | | | ** ChangeCipherSpec ** | | | | Finished | | | o----------------------------\u003e | | | | | | | | ** ChangeCipherSpec ** | | | | Finished | | | | \u003c----------------------------o | | | | | +-----+ +-----+ Optional messages -------------------------------------------------------------------------------------------- Certificate (server) 包含秘钥交换的算法（匿名通信除外） ServerKeyExchange 使用 Diffie-Hellman 秘钥交换算法时需要 CertificateRequest 如果设置了 Client authentication Certificate (client) 客户端回复服务端发送的 CertificateRequest CertificateVerify 如果客户端发送了 Certificate message Record Protocol 的格式 记录协议的记录头非常简单，占用5个字节。\nrecord type (1 byte) / / version (1 byte major, 1 byte minor) / / / / length (2 bytes) / / / +----+----+----+----+----+ | | | | | | | | | | | | TLS Record header +----+----+----+----+----+ Record Type Values dec hex ------------------------------------- CHANGE_CIPHER_SPEC 20 0x14 ALERT 21 0x15 HANDSHAKE 22 0x16 \u003c- 22 和 23 比较常见 APPLICATION_DATA 23 0x17 \u003c- Version Values dec hex ------------------------------------- SSL 3.0 3,0 0x0300 TLS 1.0 3,1 0x0301 TLS 1.1 3,2 0x0302 TLS 1.2 3,3 0x0303 Handshake Protocol 格式 握手协议的类型比较复杂，基本类型的有10种，这还不包括 TLS 扩展协议。类型占1字节，消息长度占3字节，后面是消息的内容。\n| | | Record Layer | Handshake Layer | | | | ...more messages +----+----+----+----+----+----+----+----+----+------ - - - -+-- | 22 | | | | | | | | | | |0x16| | | | | | | | |message | +----+----+----+----+----+----+----+----+----+------ - - - -+-- / / | \\ \\----\\-----\\ | / / | \\ \\ type: 22 / | \\ handshake message length + type = 占用4字节 / type / length: arbitrary (up to 16k) Handshake Type Values dec hex ------------------------------------- HELLO_REQUEST 0 0x00 CLIENT_HELLO 1 0x01 SERVER_HELLO 2 0x02 CERTIFICATE 11 0x0b SERVER_KEY_EXCHANGE 12 0x0c CERTIFICATE_REQUEST 13 0x0d SERVER_DONE 14 0x0e CERTIFICATE_VERIFY 15 0x0f CLIENT_KEY_EXCHANGE 16 0x10 FINISHED 20 0x14 HelloRequest 这是由服务器主动发起的握手，这种情况不常发生，主要是用在一个 session 已经持续了很长时间，服务器为了降低安全隐患，重新与客户端建立新的连接。\n| | | | Handshake Layer | | - ---+----+----+----+----+ | | | | | 4 | 0 | 0 | 0 | 0 | - ---+----+----+----+----+ / | \\ \\---------\\ / \\ \\ record \\ length: 0 length \\ type: 0 ClientHello 各个字段的含义很清楚，其中 session id 是指 client 在已经建立的 TLS 连接上重新建立时，可以包含这一个 session id 发给服务器。\n| | | | Handshake Layer | | - ---+----+----+----+----+----+----+------+----+----------+--------+-----------+----------+ | 1 | | | | | |32-bit| |max 32-bit| Cipher |Compression|Extensions| |0x01| | | | 3 | 1 |random| |session Id| Suites | methods | | - ---+----+----+----+----+----+----+------+----+----------+--------+-----------+----------+ / | \\ \\---------\\ \\----\\ \\ \\ / \\ \\ \\ \\ SessionId record \\ length SSL/TLS \\ length \\ version SessionId type: 1 (TLS 1.0 here) length CipherSuites +----+----+----+----+----+----+ | | | | | | | | | | | | | | +----+----+----+----+----+----+ \\-----\\ \\-----\\ \\----\\ \\ \\ \\ length cipher Id cipherId \u003c--加密算法用 id 表示 Compression methods (no practical implementation uses compression) +----+----+----+ | | | | | 0 | 1 | 0 | +----+----+----+ \\-----\\ \\ \\ \\ length: 1 cmp Id: 0 Extensions +----+----+----+----+----+----+----- - - | | | | | | | | | | | | | |...extension data +----+----+----+----+----+----+----- - - \\-----\\ \\-----\\ \\----\\ \\ \\ \\ length Extension Extension data Id length ServerHello 与 ClientHello 不同的是，它只包含一个 CipherSuite 和 一个 Compression，这是因为服务器选定要使用的加密算法和压缩算法。\n| | | | Handshake Layer | | - ---+----+----+----+----+----+----+----------+----+----------+----+----+----+----------+ | 2 | | | | | | 32byte | |max 32byte| | | |Extensions| |0x02| | | | 3 | 1 | random | |session Id| | | | | - ---+----+----+----+----+----+----+----------+----+----------+--------------+----------+ / | \\ \\---------\\ \\----\\ \\ \\ \\----\\ \\ / \\ \\ \\ \\ SessionId \\ Compression record \\ length SSL/TLS \\ (if length \u003e 0) \\ method length \\ version SessionId \\ type: 2 (TLS 1.0 here) length CipherSuite Certificate 证书链。\n| | | | Handshake Layer | | - ---+----+----+----+----+----+----+----+----+----+----+-----------+---- - - | 11 | | | | | | | | | | | |0x0b| | | | | | | | | |certificate| ...more certificate - ---+----+----+----+----+----+----+----+----+----+----+-----------+---- - - / | \\ \\---------\\ \\---------\\ \\---------\\ / \\ \\ \\ \\ record \\ length Certificate Certificate length \\ chain length type: 11 length ServerKeyExchange 由客户端接收。客户端需要服务端提供这个参数，用于建立对称加密。这是一个可选的参数，并不是所有的秘钥交换算法都需要提供这个参数。 参数的格式根据 CipherSuite 的不同而不同。\n| | | | Handshake Layer | | - ---+----+----+----+----+----------------+ | 12 | | | | algorithm | |0x0c| | | | parameters | - ---+----+----+----+----+----------------+ / | \\ \\---------\\ / \\ \\ record \\ length length \\ type: 12 CertificateRequest 服务器要求客户端也提供证书。这种在 web 服务器中并不常见。 CertificateRequest 消息告诉客户端，服务器接收哪些 certificate 类型，以及信任哪些 CA。\n| | | | Handshake Layer | | - ---+----+----+----+----+----+----+---- - - --+----+----+----+----+-----------+-- - | 13 | | | | | | | | | | | C.A. | |0x0d| | | | | | | | | | |unique name| - ---+----+----+----+----+----+----+---- - - --+----+----+----+----+-----------+-- - / | \\ \\---------\\ \\ \\ \\----\\ \\-----\\ / \\ \\ \\ Certificate \\ \\ record \\ length \\ Type 1 Id Certificate \\ length \\ Certificate Authorities length \\ type: 13 Types length Certificate Authority length ServerHelloDone 非常简单的一条消息。\n| | | | Handshake Layer | | - ---+----+----+----+----+ | 14 | | | | 4 |0x0e| 0 | 0 | 0 | - ---+----+----+----+----+ / | \\ \\---------\\ / \\ \\ record \\ length: 0 length \\ type: 14 ClientKeyExchange 它提供给服务器一个用于生成对称加密的参数。至此，客户端和服务器都拥有了相同的2份参数。\n| | | | Handshake Layer | | - ---+----+----+----+----+----------------+ | 16 | | | | algorithm | |0x10| | | | parameters | - ---+----+----+----+----+----------------+ / | \\ \\---------\\ / \\ \\ record \\ length length \\ type: 16 CertificateVerify\n| | | | Handshake Layer | | - ---+----+----+----+----+----------+ | 15 | | | | signed | |0x0f| | | | hash | - ---+----+----+----+----+----------+ / | \\ \\---------\\ / \\ \\ record \\ length length \\ type: 15 Finished 这个消息发送时，已经是被加密的了。 因为 negotiation 已经结束，ChangeCipherSpec 消息已经发送并激活双方的加密通信。 （ChangeCipherSpec 协议并不属于握手协议的一部分，因此并没有在这一节中介绍）。 Finished 消息中包含的 hash 值与CertificateVerify中的并不同，因为它包含了更多的握手信息产生的摘要。\n| | | | Handshake Layer | | - ---+----+----+----+----+----------+ | 20 | | | | signed | \u003c--- hash 之后还有 master secret |0x14| | | | hash | - ---+----+----+----+----+----------+ / | \\ \\---------\\ / \\ \\ record \\ length length \\ type: 20 ChangeCipherSpec Protocol 格式 按照逻辑理解，ChangeCipherSpec 应该是属于握手协议的一部分，但是却被单独列出来，这是因为记录协议的封装导致的。 记录协议的记录块是一整块被加密的，一个记录块小于等于 2^16 字节。假如 ChangeCipherSpec 所在块中有用户数据，那么这个数据 应该被加密，但是事实上，无法对记录块中的部分数据进行加密。所以单独列出。\n| | | Record Layer | ChangeCipherSpec Layer | | +----+----+----+----+----+----+ | 20 | | | | | | |0x14| | | 0 | 1 | 1 | +----+----+----+----+----+----+ / / | / / | type: 20 / | / / length: 1 Alert Protocol 格式 警告协议报告通信过程中出现的异常。消息格式非常简单。\n| | | Record Layer | Alert Layer | | +----+----+----+----+----+----+----+ | 21 | | | | | | | |0x15| | | 0 | 2 | | | +----+----+----+----+----+----+----+ / / | / / | type: 21 / | / / length: 2 Alert severity dec hex ---------------------------------------- WARNING 1 0x01 FATAL 2 0x02 TLS 1.0 Alert descriptions dec hex ---------------------------------------- CLOSE_NOTIFY 0 0x00 UNEXPECTED_MESSAGE 10 0x0A BAD_RECORD_MAC 20 0x14 DECRYPTION_FAILED 21 0x15 RECORD_OVERFLOW 22 0x16 DECOMPRESSION_FAILURE 30 0x1E HANDSHAKE_FAILURE 40 0x28 NO_CERTIFICATE 41 0x29 BAD_CERTIFICATE 42 0x2A UNSUPPORTED_CERTIFICATE 43 0x2B CERTIFICATE_REVOKED 44 0x2C CERTIFICATE_EXPIRED 45 0x2D CERTIFICATE_UNKNOWN 46 0x2E ILLEGAL_PARAMETER 47 0x2F UNKNOWN_CA 48 0x30 ACCESS_DENIED 49 0x31 DECODE_ERROR 50 0x32 DECRYPT_ERROR 51 0x33 EXPORT_RESTRICTION 60 0x3C PROTOCOL_VERSION 70 0x46 INSUFFICIENT_SECURITY 71 0x47 INTERNAL_ERROR 80 0x50 USER_CANCELLED 90 0x5A NO_RENEGOTIATION 100 0x64 ApplicationData Protocol 格式 | | | Record Layer | ApplicationData Layer (encrypted) | | +----+----+----+----+----+----+----+--- - - - - - - --+---------+ | 23 | | | | length-delimited data | | |0x17| | | | | | | | MAC | +----+----+----+----+----+----+----+--- - - - - - - --+---------+ / / | / / | type: 23 / | / / length: arbitrary (up to 16k) ","wordCount":"1428","inLanguage":"en","image":"https://runzhen.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2016-06-18T00:00:00Z","dateModified":"2016-06-18T00:00:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://runzhen.github.io/posts/tls-basic/"},"publisher":{"@type":"Organization","name":"Mind in the Wind","logo":{"@type":"ImageObject","url":"https://runzhen.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://runzhen.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://runzhen.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://runzhen.github.io/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://runzhen.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://runzhen.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://runzhen.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">TLS 1.2 协议格式</h1><div class=post-meta><span title='2016-06-18 00:00:00 +0000 UTC'>2016-06-18</span>&nbsp;·&nbsp;Me</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><ul><li><a href=#lower-layer aria-label="Lower Layer">Lower Layer</a></li><li><a href=#higher-layer aria-label="Higher Layer">Higher Layer</a></li><li><a href=#record-protocol-%e7%9a%84%e6%a0%bc%e5%bc%8f aria-label="Record Protocol 的格式">Record Protocol 的格式</a></li><li><a href=#handshake-protocol-%e6%a0%bc%e5%bc%8f aria-label="Handshake Protocol 格式">Handshake Protocol 格式</a></li><li><a href=#changecipherspec-protocol-%e6%a0%bc%e5%bc%8f aria-label="ChangeCipherSpec Protocol 格式">ChangeCipherSpec Protocol 格式</a></li><li><a href=#alert-protocol-%e6%a0%bc%e5%bc%8f aria-label="Alert Protocol 格式">Alert Protocol 格式</a></li></ul><li><a href=#applicationdata-protocol-%e6%a0%bc%e5%bc%8f aria-label="ApplicationData Protocol 格式">ApplicationData Protocol 格式</a></li></ul></div></details></div><div class=post-content><p>本文内容来自《Traffic Analysis of an SSL/TLS Session》的阅读笔记，原文见<a href=http://blog.fourthbit.com/2014/12/23/traffic-analysis-of-an-ssl-slash-tls-session>此处</a>。</p><p>TLS 全称为 Transport Layer Security，它本身也分为了 Lower 和 Higher 两层协议。</p><h2 id=lower-layer>Lower Layer<a hidden class=anchor aria-hidden=true href=#lower-layer>#</a></h2><p>Lower Layer 协议在 TCP 协议之上，提供面向连接的可靠传输，在这一层的协议主要是记录协议（TLS Record Protocol）。
记录协议首先把上层协议传来的数据分成小于2^14字节的数据块，如果设置了压缩选项，则第二步为压缩数据，然后在数据块的末尾增加
MAC（Message Authentication Code），第三步将数据块加密，最后增加记录头。该过程如下所示。</p><p>each block is packed into a structure that does not preserve client message boundaries, meaning that mulitiple message of the same type maybe coalesced into a single structure</p><pre tabindex=0><code>-----------+
  data   --+--------------&gt; 1. Fragment data
-----------+
                            +------------------------+
                            |                        |
                            |                        |
                            +------------------------+
                            2. Compress data (generally no compression applied)
                            +------------------------+----+
                            |                        |MAC | Add a Message Authentication Code
                            |                        |    |
                            +------------------------+----+
                            3. Encrypt data
                            +-----------------------------+
                            |ciphertext                   |
                            |                             |
                            +-----------------------------+
                            4. Add header
                       +----+-----------------------------+
            TLS Record |    |ciphertext                   | Add a TLS Record header
              header   |    |                             |
                       +----+-----------------------------+
</code></pre><h2 id=higher-layer>Higher Layer<a hidden class=anchor aria-hidden=true href=#higher-layer>#</a></h2><p>主要有四种协议。</p><ul><li>握手协议（Handshake Protocol）建立通信。</li><li>密钥交换协议（ChangeCipherSpec Protocol）让之前协商好的协议生效，此时通信加密。</li><li>警告协议（Alter Protocol）通信出现异常时使用，提示用户潜在的安全问题。</li><li>程序数据协议（Application Data Protocol）数据通信。</li></ul><p>握手的过程如下所示。</p><pre tabindex=0><code>               TLS Handshake

               +-----+                              +-----+
               |     |                              |     |
               |     |        ClientHello           |     |
               |     o----------------------------&gt; |     |
               |     |                              |     |
       CLIENT  |     |        ServerHello           |     |  SERVER
               |     |       [Certificate]          |     |
               |     |    [ServerKeyExchange]       |     |
               |     |    [CertificateRequest]      |     |
               |     |      ServerHelloDone         |     |
               |     | &lt;----------------------------o     |
               |     |                              |     |
               |     |       [Certificate]          |     |
               |     |     ClientKeyExchange        |     |
               |     |    [CertificateVerify]       |     |
               |     |   ** ChangeCipherSpec **     |     |
               |     |         Finished             |     |
               |     o----------------------------&gt; |     |
               |     |                              |     |
               |     |   ** ChangeCipherSpec **     |     |
               |     |         Finished             |     |
               |     | &lt;----------------------------o     |
               |     |                              |     |
               +-----+                              +-----+
 Optional messages
 --------------------------------------------------------------------------------------------
 Certificate (server)     包含秘钥交换的算法（匿名通信除外）
 ServerKeyExchange        使用 Diffie-Hellman 秘钥交换算法时需要
 CertificateRequest       如果设置了 Client authentication
 Certificate (client)     客户端回复服务端发送的 CertificateRequest
 CertificateVerify        如果客户端发送了 Certificate message
</code></pre><h2 id=record-protocol-的格式>Record Protocol 的格式<a hidden class=anchor aria-hidden=true href=#record-protocol-的格式>#</a></h2><p>记录协议的记录头非常简单，占用5个字节。</p><pre tabindex=0><code>         record type (1 byte)
        /
       /    version (1 byte major, 1 byte minor)
      /    /
     /    /         length (2 bytes)
    /    /         /
 +----+----+----+----+----+
 |    |    |    |    |    |
 |    |    |    |    |    | TLS Record header
 +----+----+----+----+----+

 Record Type Values       dec      hex
 -------------------------------------
 CHANGE_CIPHER_SPEC        20     0x14
 ALERT                     21     0x15
 HANDSHAKE                 22     0x16  &lt;- 22 和 23 比较常见
 APPLICATION_DATA          23     0x17  &lt;-

 Version Values            dec     hex
 -------------------------------------
 SSL 3.0                   3,0  0x0300
 TLS 1.0                   3,1  0x0301
 TLS 1.1                   3,2  0x0302
 TLS 1.2                   3,3  0x0303
</code></pre><h2 id=handshake-protocol-格式>Handshake Protocol 格式<a hidden class=anchor aria-hidden=true href=#handshake-protocol-格式>#</a></h2><p>握手协议的类型比较复杂，基本类型的有10种，这还不包括 TLS 扩展协议。类型占1字节，消息长度占3字节，后面是消息的内容。</p><pre tabindex=0><code>                           |
                           |
                           |
         Record Layer      |  Handshake Layer
                           |                                  |
                           |                                  |  ...more messages
  +----+----+----+----+----+----+----+----+----+------ - - - -+--
  | 22 |    |    |    |    |    |    |    |    |              |
  |0x16|    |    |    |    |    |    |    |    |message       |
  +----+----+----+----+----+----+----+----+----+------ - - - -+--
    /               /      | \    \----\-----\                |
   /               /       |  \         \
  type: 22        /        |   \         handshake message length  + type = 占用4字节
                 /              type
                /
           length: arbitrary (up to 16k)


   Handshake Type Values    dec      hex
   -------------------------------------
   HELLO_REQUEST              0     0x00
   CLIENT_HELLO               1     0x01
   SERVER_HELLO               2     0x02
   CERTIFICATE               11     0x0b
   SERVER_KEY_EXCHANGE       12     0x0c
   CERTIFICATE_REQUEST       13     0x0d
   SERVER_DONE               14     0x0e
   CERTIFICATE_VERIFY        15     0x0f
   CLIENT_KEY_EXCHANGE       16     0x10
   FINISHED                  20     0x14
</code></pre><p><strong>HelloRequest</strong> 这是由服务器主动发起的握手，这种情况不常发生，主要是用在一个 session 已经持续了很长时间，服务器为了降低安全隐患，重新与客户端建立新的连接。</p><pre tabindex=0><code>     |
     |
     |
     |  Handshake Layer
     |
     |
- ---+----+----+----+----+
     |    |    |    |    |
   4 |  0 |  0 |  0 |  0 |
- ---+----+----+----+----+
  /  |  \    \---------\
 /       \        \
record    \    length: 0
length     \
            type: 0
</code></pre><p><strong>ClientHello</strong> 各个字段的含义很清楚，其中 session id 是指 client 在已经建立的 TLS 连接上重新建立时，可以包含这一个 session id 发给服务器。</p><pre tabindex=0><code>     |
     |
     |
     |  Handshake Layer
     |
     |
- ---+----+----+----+----+----+----+------+----+----------+--------+-----------+----------+
     |  1 |    |    |    |    |    |32-bit|    |max 32-bit| Cipher |Compression|Extensions|
     |0x01|    |    |    |  3 |  1 |random|    |session Id| Suites |  methods  |          |
- ---+----+----+----+----+----+----+------+----+----------+--------+-----------+----------+
  /  |  \    \---------\    \----\             \       \
 /       \        \            \                \   SessionId
record    \     length        SSL/TLS            \
length     \                  version         SessionId
            type: 1       (TLS 1.0 here)       length

CipherSuites

+----+----+----+----+----+----+
|    |    |    |    |    |    |
|    |    |    |    |    |    |
+----+----+----+----+----+----+
  \-----\   \-----\    \----\
     \         \          \
      length    cipher Id  cipherId     &lt;--加密算法用 id 表示

Compression methods (no practical implementation uses compression)

+----+----+----+
|    |    |    |
|  0 |  1 |  0 |
+----+----+----+
  \-----\    \
     \        \
 length: 1    cmp Id: 0

Extensions

+----+----+----+----+----+----+----- - -
|    |    |    |    |    |    |
|    |    |    |    |    |    |...extension data
+----+----+----+----+----+----+----- - -
  \-----\   \-----\    \----\
     \         \          \
    length    Extension  Extension data
                 Id          length
</code></pre><p><strong>ServerHello</strong> 与 ClientHello 不同的是，它只包含一个 CipherSuite 和 一个 Compression，这是因为服务器选定要使用的加密算法和压缩算法。</p><pre tabindex=0><code>     |
     |
     |
     |  Handshake Layer
     |
     |
- ---+----+----+----+----+----+----+----------+----+----------+----+----+----+----------+
     |  2 |    |    |    |    |    |  32byte  |    |max 32byte|    |    |    |Extensions|
     |0x02|    |    |    |  3 |  1 |  random  |    |session Id|    |    |    |          |
- ---+----+----+----+----+----+----+----------+----+----------+--------------+----------+
  /  |  \    \---------\    \----\               \       \       \----\    \
 /       \        \            \                  \   SessionId      \  Compression
record    \     length        SSL/TLS              \ (if length &gt; 0)  \   method
length     \                  version           SessionId              \
            type: 2       (TLS 1.0 here)         length            CipherSuite
</code></pre><p><strong>Certificate</strong> 证书链。</p><pre tabindex=0><code>     |
     |
     |
     |  Handshake Layer
     |
     |
- ---+----+----+----+----+----+----+----+----+----+----+-----------+---- - -
     | 11 |    |    |    |    |    |    |    |    |    |           |
     |0x0b|    |    |    |    |    |    |    |    |    |certificate| ...more certificate
- ---+----+----+----+----+----+----+----+----+----+----+-----------+---- - -
  /  |  \    \---------\    \---------\    \---------\
 /       \        \              \              \
record    \     length      Certificate    Certificate
length     \                   chain         length
            type: 11           length
</code></pre><p><strong>ServerKeyExchange</strong> 由客户端接收。客户端需要服务端提供这个参数，用于建立对称加密。这是一个可选的参数，并不是所有的秘钥交换算法都需要提供这个参数。
参数的格式根据 CipherSuite 的不同而不同。</p><pre tabindex=0><code>     |
     |
     |
     |  Handshake Layer
     |
     |
- ---+----+----+----+----+----------------+
     | 12 |    |    |    |   algorithm    |
     |0x0c|    |    |    |   parameters   |
- ---+----+----+----+----+----------------+
  /  |  \    \---------\
 /       \        \
record    \     length
length     \
            type: 12
</code></pre><p><strong>CertificateRequest</strong> 服务器要求客户端也提供证书。这种在 web 服务器中并不常见。
CertificateRequest 消息告诉客户端，服务器接收哪些 certificate 类型，以及信任哪些 CA。</p><pre tabindex=0><code>     |
     |
     |
     |  Handshake Layer
     |
     |
- ---+----+----+----+----+----+----+---- - - --+----+----+----+----+-----------+-- -
     | 13 |    |    |    |    |    |           |    |    |    |    |    C.A.   |
     |0x0d|    |    |    |    |    |           |    |    |    |    |unique name|
- ---+----+----+----+----+----+----+---- - - --+----+----+----+----+-----------+-- -
  /  |  \    \---------\    \    \                \----\   \-----\
 /       \        \          \ Certificate           \        \
record    \     length        \ Type 1 Id        Certificate   \
length     \             Certificate         Authorities length \
            type: 13     Types length                         Certificate Authority
                                                                      length
</code></pre><p><strong>ServerHelloDone</strong> 非常简单的一条消息。</p><pre tabindex=0><code>     |
     |
     |
     |  Handshake Layer
     |
     |
- ---+----+----+----+----+
     | 14 |    |    |    |
   4 |0x0e|  0 |  0 |  0 |
- ---+----+----+----+----+
  /  |  \    \---------\
 /       \        \
record    \     length: 0
length     \
            type: 14
</code></pre><p><strong>ClientKeyExchange</strong> 它提供给服务器一个用于生成对称加密的参数。至此，客户端和服务器都拥有了相同的2份参数。</p><pre tabindex=0><code>     |
     |
     |
     |  Handshake Layer
     |
     |
- ---+----+----+----+----+----------------+
     | 16 |    |    |    |   algorithm    |
     |0x10|    |    |    |   parameters   |
- ---+----+----+----+----+----------------+
  /  |  \    \---------\
 /       \        \
record    \     length
length     \
            type: 16
</code></pre><p><strong>CertificateVerify</strong></p><pre tabindex=0><code>     |
     |
     |
     |  Handshake Layer
     |
     |
- ---+----+----+----+----+----------+
     | 15 |    |    |    |  signed  |
     |0x0f|    |    |    |   hash   |
- ---+----+----+----+----+----------+
  /  |  \    \---------\
 /       \        \
record    \     length
length     \
            type: 15
</code></pre><p><strong>Finished</strong> 这个消息发送时，已经是被加密的了。
因为 negotiation 已经结束，ChangeCipherSpec 消息已经发送并激活双方的加密通信。
（ChangeCipherSpec 协议并不属于握手协议的一部分，因此并没有在这一节中介绍）。
Finished 消息中包含的 hash 值与CertificateVerify中的并不同，因为它包含了更多的握手信息产生的摘要。</p><pre tabindex=0><code>     |
     |
     |
     |  Handshake Layer
     |
     |
- ---+----+----+----+----+----------+
     | 20 |    |    |    |  signed  |  &lt;--- hash 之后还有 master secret 
     |0x14|    |    |    |   hash   |
- ---+----+----+----+----+----------+
  /  |  \    \---------\
 /       \        \
record    \     length
length     \
            type: 20
</code></pre><h2 id=changecipherspec-protocol-格式>ChangeCipherSpec Protocol 格式<a hidden class=anchor aria-hidden=true href=#changecipherspec-protocol-格式>#</a></h2><p>按照逻辑理解，ChangeCipherSpec 应该是属于握手协议的一部分，但是却被单独列出来，这是因为记录协议的封装导致的。
记录协议的记录块是一整块被加密的，一个记录块小于等于 2^16 字节。假如 ChangeCipherSpec 所在块中有用户数据，那么这个数据
应该被加密，但是事实上，无法对记录块中的部分数据进行加密。所以单独列出。</p><pre tabindex=0><code>                           |
                           |
                           |
         Record Layer      |  ChangeCipherSpec Layer
                           |
                           |
  +----+----+----+----+----+----+
  | 20 |    |    |    |    |    |
  |0x14|    |    |  0 |  1 |  1 |
  +----+----+----+----+----+----+
    /               /      |
   /               /       |
  type: 20        /        |
                 /
                /
           length: 1
</code></pre><h2 id=alert-protocol-格式>Alert Protocol 格式<a hidden class=anchor aria-hidden=true href=#alert-protocol-格式>#</a></h2><p>警告协议报告通信过程中出现的异常。消息格式非常简单。</p><pre tabindex=0><code>                           |
                           |
                           |
         Record Layer      |  Alert Layer
                           |
                           |
  +----+----+----+----+----+----+----+
  | 21 |    |    |    |    |    |    |
  |0x15|    |    |  0 |  2 |    |    |
  +----+----+----+----+----+----+----+
    /               /      |
   /               /       |
  type: 21        /        |
                 /
                /
           length: 2

  Alert severity               dec     hex
  ----------------------------------------
  WARNING                        1    0x01
  FATAL                          2    0x02

  TLS 1.0 Alert descriptions   dec     hex
  ----------------------------------------

  CLOSE_NOTIFY                   0    0x00
  UNEXPECTED_MESSAGE            10    0x0A
  BAD_RECORD_MAC                20    0x14
  DECRYPTION_FAILED             21    0x15
  RECORD_OVERFLOW               22    0x16
  DECOMPRESSION_FAILURE         30    0x1E
  HANDSHAKE_FAILURE             40    0x28
  NO_CERTIFICATE                41    0x29
  BAD_CERTIFICATE               42    0x2A
  UNSUPPORTED_CERTIFICATE       43    0x2B
  CERTIFICATE_REVOKED           44    0x2C
  CERTIFICATE_EXPIRED           45    0x2D
  CERTIFICATE_UNKNOWN           46    0x2E
  ILLEGAL_PARAMETER             47    0x2F
  UNKNOWN_CA                    48    0x30
  ACCESS_DENIED                 49    0x31
  DECODE_ERROR                  50    0x32
  DECRYPT_ERROR                 51    0x33
  EXPORT_RESTRICTION            60    0x3C
  PROTOCOL_VERSION              70    0x46
  INSUFFICIENT_SECURITY         71    0x47
  INTERNAL_ERROR                80    0x50
  USER_CANCELLED                90    0x5A
  NO_RENEGOTIATION             100    0x64
</code></pre><h1 id=applicationdata-protocol-格式>ApplicationData Protocol 格式<a hidden class=anchor aria-hidden=true href=#applicationdata-protocol-格式>#</a></h1><pre tabindex=0><code>                           |
                           |
                           |
         Record Layer      |  ApplicationData Layer (encrypted)
                           |
                           |
  +----+----+----+----+----+----+----+--- - - - - - - --+---------+
  | 23 |    |    |    |       length-delimited data     |         |
  |0x17|    |    |    |    |    |    |                  |   MAC   |
  +----+----+----+----+----+----+----+--- - - - - - - --+---------+
    /               /      |
   /               /       |
  type: 23        /        |
                 /
                /
           length: arbitrary (up to 16k)
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://runzhen.github.io/tags/tls/>Tls</a></li></ul><nav class=paginav><a class=prev href=https://runzhen.github.io/posts/tls2-packets/><span class=title>« Prev</span><br><span>抓包分析 TLS 1.2 连接过程</span>
</a><a class=next href=https://runzhen.github.io/posts/zone-highmem/><span class=title>Next »</span><br><span>Linux 内核在 x86-64 上的内存分区</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share TLS 1.2 协议格式 on x" href="https://x.com/intent/tweet/?text=TLS%201.2%20%e5%8d%8f%e8%ae%ae%e6%a0%bc%e5%bc%8f&amp;url=https%3a%2f%2frunzhen.github.io%2fposts%2ftls-basic%2f&amp;hashtags=tls"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TLS 1.2 协议格式 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frunzhen.github.io%2fposts%2ftls-basic%2f&amp;title=TLS%201.2%20%e5%8d%8f%e8%ae%ae%e6%a0%bc%e5%bc%8f&amp;summary=TLS%201.2%20%e5%8d%8f%e8%ae%ae%e6%a0%bc%e5%bc%8f&amp;source=https%3a%2f%2frunzhen.github.io%2fposts%2ftls-basic%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TLS 1.2 协议格式 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2frunzhen.github.io%2fposts%2ftls-basic%2f&title=TLS%201.2%20%e5%8d%8f%e8%ae%ae%e6%a0%bc%e5%bc%8f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TLS 1.2 协议格式 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frunzhen.github.io%2fposts%2ftls-basic%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TLS 1.2 协议格式 on whatsapp" href="https://api.whatsapp.com/send?text=TLS%201.2%20%e5%8d%8f%e8%ae%ae%e6%a0%bc%e5%bc%8f%20-%20https%3a%2f%2frunzhen.github.io%2fposts%2ftls-basic%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TLS 1.2 协议格式 on telegram" href="https://telegram.me/share/url?text=TLS%201.2%20%e5%8d%8f%e8%ae%ae%e6%a0%bc%e5%bc%8f&amp;url=https%3a%2f%2frunzhen.github.io%2fposts%2ftls-basic%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TLS 1.2 协议格式 on ycombinator" href="https://news.ycombinator.com/submitlink?t=TLS%201.2%20%e5%8d%8f%e8%ae%ae%e6%a0%bc%e5%bc%8f&u=https%3a%2f%2frunzhen.github.io%2fposts%2ftls-basic%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://runzhen.github.io/>Mind in the Wind</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>