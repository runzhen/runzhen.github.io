<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>What is cgroups ? | Mind in the Wind</title>
<meta name=keywords content="linux"><meta name=description content="cgroup 比较有趣的地方是它没有提供任何的系统调用接口，所以你不能用 API Call 的方式使用 cgroup，实际上 cgroup 实现了 linux 虚拟文件系统 vfs，所以类似我们熟悉的 btfrs, ext4， 因此可以用类似文件系统的方式进行操作。
比如用 mount 命令看一下 linux 上挂载了哪些设备：
# mount -t cgroup /dev/sda2 on / type ext4 (rw,relatime) cgroup on /sys/fs/cgroup/systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,name=systemd) cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,net_cls,net_prio) cgroup on /sys/fs/cgroup/rdma type cgroup (rw,nosuid,nodev,noexec,relatime,rdma) cgroup2 on /sys/fs/cgroup type cgroup2 (rw,nosuid,nodev,noexec,relatime,nsdelegate,memory_recursiveprot) 可以看到，
第一行是磁盘 sda2 挂载在根目录 /, 它的类型是 ext4 后面几行是 cgroup 挂载在了目录 /sys/fs/cgroup/，类型是 cgroup 如果你的内核比较新的话，将看不到上面那些 cgroup 的行，而是只能看到最后这一行 cgroup2，这是因为新版本的内核使用了 cgroup v2 。 另外类似于 “net_cls”， “rdma” 这些都是 cgroup 子系统的名字，详见本文结尾的附录。"><meta name=author content="Me"><link rel=canonical href=https://runzhen.github.io/posts/cgroups-intro/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.103f87022495ee8537d399aa50bf7e2203f4c653b709467478c7fd5a58182364.css integrity="sha256-ED+HAiSV7oU305mqUL9+IgP0xlO3CUZ0eMf9WlgYI2Q=" rel="preload stylesheet" as=style><link rel=icon href=https://runzhen.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://runzhen.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://runzhen.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://runzhen.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://runzhen.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://runzhen.github.io/posts/cgroups-intro/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="What is cgroups ?"><meta property="og:description" content="cgroup 比较有趣的地方是它没有提供任何的系统调用接口，所以你不能用 API Call 的方式使用 cgroup，实际上 cgroup 实现了 linux 虚拟文件系统 vfs，所以类似我们熟悉的 btfrs, ext4， 因此可以用类似文件系统的方式进行操作。
比如用 mount 命令看一下 linux 上挂载了哪些设备：
# mount -t cgroup /dev/sda2 on / type ext4 (rw,relatime) cgroup on /sys/fs/cgroup/systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,name=systemd) cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,net_cls,net_prio) cgroup on /sys/fs/cgroup/rdma type cgroup (rw,nosuid,nodev,noexec,relatime,rdma) cgroup2 on /sys/fs/cgroup type cgroup2 (rw,nosuid,nodev,noexec,relatime,nsdelegate,memory_recursiveprot) 可以看到，
第一行是磁盘 sda2 挂载在根目录 /, 它的类型是 ext4 后面几行是 cgroup 挂载在了目录 /sys/fs/cgroup/，类型是 cgroup 如果你的内核比较新的话，将看不到上面那些 cgroup 的行，而是只能看到最后这一行 cgroup2，这是因为新版本的内核使用了 cgroup v2 。 另外类似于 “net_cls”， “rdma” 这些都是 cgroup 子系统的名字，详见本文结尾的附录。"><meta property="og:type" content="article"><meta property="og:url" content="https://runzhen.github.io/posts/cgroups-intro/"><meta property="og:image" content="https://runzhen.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-22T00:00:00+00:00"><meta property="og:site_name" content="Mind in the Wind"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://runzhen.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="What is cgroups ?"><meta name=twitter:description content="cgroup 比较有趣的地方是它没有提供任何的系统调用接口，所以你不能用 API Call 的方式使用 cgroup，实际上 cgroup 实现了 linux 虚拟文件系统 vfs，所以类似我们熟悉的 btfrs, ext4， 因此可以用类似文件系统的方式进行操作。
比如用 mount 命令看一下 linux 上挂载了哪些设备：
# mount -t cgroup /dev/sda2 on / type ext4 (rw,relatime) cgroup on /sys/fs/cgroup/systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,name=systemd) cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,net_cls,net_prio) cgroup on /sys/fs/cgroup/rdma type cgroup (rw,nosuid,nodev,noexec,relatime,rdma) cgroup2 on /sys/fs/cgroup type cgroup2 (rw,nosuid,nodev,noexec,relatime,nsdelegate,memory_recursiveprot) 可以看到，
第一行是磁盘 sda2 挂载在根目录 /, 它的类型是 ext4 后面几行是 cgroup 挂载在了目录 /sys/fs/cgroup/，类型是 cgroup 如果你的内核比较新的话，将看不到上面那些 cgroup 的行，而是只能看到最后这一行 cgroup2，这是因为新版本的内核使用了 cgroup v2 。 另外类似于 “net_cls”， “rdma” 这些都是 cgroup 子系统的名字，详见本文结尾的附录。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://runzhen.github.io/posts/"},{"@type":"ListItem","position":2,"name":"What is cgroups ?","item":"https://runzhen.github.io/posts/cgroups-intro/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"What is cgroups ?","name":"What is cgroups ?","description":"cgroup 比较有趣的地方是它没有提供任何的系统调用接口，所以你不能用 API Call 的方式使用 cgroup，实际上 cgroup 实现了 linux 虚拟文件系统 vfs，所以类似我们熟悉的 btfrs, ext4， 因此可以用类似文件系统的方式进行操作。\n比如用 mount 命令看一下 linux 上挂载了哪些设备：\n# mount -t cgroup /dev/sda2 on / type ext4 (rw,relatime) cgroup on /sys/fs/cgroup/systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,name=systemd) cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,net_cls,net_prio) cgroup on /sys/fs/cgroup/rdma type cgroup (rw,nosuid,nodev,noexec,relatime,rdma) cgroup2 on /sys/fs/cgroup type cgroup2 (rw,nosuid,nodev,noexec,relatime,nsdelegate,memory_recursiveprot) 可以看到，\n第一行是磁盘 sda2 挂载在根目录 /, 它的类型是 ext4 后面几行是 cgroup 挂载在了目录 /sys/fs/cgroup/，类型是 cgroup 如果你的内核比较新的话，将看不到上面那些 cgroup 的行，而是只能看到最后这一行 cgroup2，这是因为新版本的内核使用了 cgroup v2 。 另外类似于 “net_cls”， “rdma” 这些都是 cgroup 子系统的名字，详见本文结尾的附录。","keywords":["linux"],"articleBody":"cgroup 比较有趣的地方是它没有提供任何的系统调用接口，所以你不能用 API Call 的方式使用 cgroup，实际上 cgroup 实现了 linux 虚拟文件系统 vfs，所以类似我们熟悉的 btfrs, ext4， 因此可以用类似文件系统的方式进行操作。\n比如用 mount 命令看一下 linux 上挂载了哪些设备：\n# mount -t cgroup /dev/sda2 on / type ext4 (rw,relatime) cgroup on /sys/fs/cgroup/systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,name=systemd) cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,net_cls,net_prio) cgroup on /sys/fs/cgroup/rdma type cgroup (rw,nosuid,nodev,noexec,relatime,rdma) cgroup2 on /sys/fs/cgroup type cgroup2 (rw,nosuid,nodev,noexec,relatime,nsdelegate,memory_recursiveprot) 可以看到，\n第一行是磁盘 sda2 挂载在根目录 /, 它的类型是 ext4 后面几行是 cgroup 挂载在了目录 /sys/fs/cgroup/，类型是 cgroup 如果你的内核比较新的话，将看不到上面那些 cgroup 的行，而是只能看到最后这一行 cgroup2，这是因为新版本的内核使用了 cgroup v2 。 另外类似于 “net_cls”， “rdma” 这些都是 cgroup 子系统的名字，详见本文结尾的附录。\n知道了上面这些，那么我们就能用操作文件系统的方式使用 cgroup 了，正好我有两台 linux VM，\n一个 Ubuntu Server 22.04，内核 5.15， 默认使用了 cgroup v2 另一个是 Ubuntu Server 20.04, 内核 5.4，使用 cgroup v1 cgroup 和 cgroup2 有很多不一样的地方，具体见参考资料 1。本文所有例子都基于 cgroup v2。\n直接使用 cgroup 既然 cgroup 实现了 VFS，那么就能用 mkdir 创建一个目录，比如\n# cd /sys/fs/cgroup/ # mkdir test # ls test cgroup.controllers cgroup.type cpu.stat hugetlb.1GB.rsvd.max io.stat memory.oom.group pids.events cgroup.events cpu.idle cpu.uclamp.max hugetlb.2MB.current io.weight memory.pressure pids.max cgroup.freeze cpu.max cpu.uclamp.min hugetlb.2MB.events memory.current memory.stat rdma.current cgroup.kill cpu.max.burst cgroup.controllers：这个文件显示了当前cgoup可以限制的相关资源有哪些。 cpu.max 限制了最大可用的 cpu 时间。 在 cgroup v1 中可以设置 cpu.cfs_quota_us 和 cpu.cfs_period_us 的值来限制 cpu 使用率，参考资料里大多是用的 v1。 到了 cgroup v2 我们需要在 cpu.max 文件中写入这两个值。后面还会提到。 如果要设置某个 cgroup 的参数就是直接往对应的文件中写入特定格式的内容，比如要限制 cgroup 能够使用的 CPU 核数：\n# echo 0-1 \u003e /sys/fs/cgroup/test/cpuset.cpus 如果要用 “test” group 限制某个进程，只要把这个进程 PID 写入 cgroup.procs 文件\n// $$ 表示当前 bash 的 PID， $ echo $$ | sudo tee /sys/fs/cgroup/test/cgroup.procs 25982 上面这个例子的结果就是所有在当前 bash 创建的进程都会收到 cgroup “test” 的限制。\n显然，这样直接的方式很不方便，因此就有了 cgroup-tools。\n使用 cgroup-tools 在 ubuntu 系统中可以用下面这个命令安装\nsudo apt-get install -y cgroup-tools 新版本的 tools 也加入了对 cgroup v2 的支持。下面通过 2 个例子来熟悉一下使用方式。\n例 1 - 限制进程可用的 CPU 时间 还是沿用上面已经创建好的名为 “test” 的 group。\n首先确认一下 root group 里面的 cgroup.controllers 和 subtree_control 包含了 cpu，如果没有的话需要手动加上 “cpu”。\nroot@loquat:/sys/fs/cgroup# cat cgroup.controllers cpuset cpu io memory hugetlb pids rdma misc root@loquat:/sys/fs/cgroup# cat cgroup.subtree_control cpuset cpu io memory pids # test group 的 cgroup.controllers 与上层 subtree_control 保持一致 root@loquat:/sys/fs/cgroup# cat test/cgroup.controllers cpuset cpu io memory pids 再在 cpu.max 中写入\nroot@loquat:/sys/fs/cgroup# cat test/cpu.max 10000 100000 其含义是在linux CFS 进程调度的周期 1000000 us (也就是 100ms) 内，使用 10000 us (10 ms)。\n再写一个程序循环很多次\nvoid main(){ unsigned int i, end; end = 1024 * 1024 * 1024; for(i = 0; i \u003c end; ) { i ++; } } 结果：\nroot@loquat:/home/runzhen/code/cgroups# time ./cputime real\t0m1.937s user\t0m1.937s sys\t0m0.000s root@loquat:/home/runzhen/code/cgroups# time cgexec -g cpu:test ./cputime real\t0m19.560s user\t0m1.975s sys\t0m0.000s 其中 user 表示的就是用户感知的时间，可见，当没有 cgroup 限制时大约 1.9 秒就结束了，当有 cgroup 限制时用了 19 秒，十倍的差距，符合我们之前设定的值。\n例 2 - 限制进程可用的最大内存 类似的，再 memory 相关文件中写入值。\nroot@loquat:/sys/fs/cgroup/test# cat memory.max 5242880 root@loquat:/sys/fs/cgroup/test# cat memory.swap.max 0 memory.max 中值的单位是 “bytes”，因此 5242880 表示最大使用 500MB 内存。\n另外需要注意的是关闭 swap，设置为 0\n测试程序如下\n#include #include #include #define CHUNK_SIZE 1024 * 1024 * 100 void main() { char *p; int i; for(i = 0; i \u003c 5; i ++) { p = malloc(sizeof(char) * CHUNK_SIZE); if(p == NULL) { printf(\"fail to malloc!\"); return ; } memset(p, 0, CHUNK_SIZE); printf(\"malloc memory %d MB\\n\", (i + 1) * 100); } } 运行结果\nroot@loquat:/home/runzhen/code/cgroups# ./mem malloc memory 100 MB malloc memory 200 MB malloc memory 300 MB malloc memory 400 MB malloc memory 500 MB root@loquat:/home/runzhen/code/cgroups# cgexec -g memory:test ./mem Killed 测试程序因为 OOM 被 kill 了。\n使用 stress 测试工具也能看到进程被 SIGKILL signal 9 了。\n# cgexec -g memory:test stress --vm 1 --vm-bytes 500000000 --vm-keep --verbose stress: info: [2684] dispatching hogs: 0 cpu, 0 io, 1 vm, 0 hdd stress: dbug: [2684] using backoff sleep of 3000us stress: dbug: [2684] --\u003e hogvm worker 1 [2685] forked stress: dbug: [2685] allocating 500000000 bytes ... stress: dbug: [2685] touching bytes in strides of 4096 bytes ... stress: FAIL: [2684] (416) \u003c-- worker 2685 got signal 9 stress: WARN: [2684] (418) now reaping child worker processes stress: FAIL: [2684] (452) failed run completed in 0s 附录 子资源系统（Resource Classes or SubSystem） 目前有下面这些资源子系统：\nBlock IO（blkio)：限制块设备（磁盘、SSD、USB 等）的 IO 速率 CPU Set(cpuset)：限制任务能运行在哪些 CPU 核上 CPU Accounting(cpuacct)：生成 cgroup 中任务使用 CPU 的报告 CPU (CPU)：限制调度器分配的 CPU 时间 Devices (devices)：允许或者拒绝 cgroup 中任务对设备的访问 Freezer (freezer)：挂起或者重启 cgroup 中的任务 Memory (memory)：限制 cgroup 中任务使用内存的量，并生成任务当前内存的使用情况报告 Network Classifier(net_cls)：为 cgroup 中的报文设置上特定的 classid 标志，这样 tc 等工具就能根据标记对网络进行配置 Network Priority (net_prio)：对每个网络接口设置报文的优先级 perf_event：识别任务的 cgroup 成员，可以用来做性能分析 参考资料 https://adtxl.com/index.php/archives/179.html https://zorrozou.github.io/docs/详解Cgroup V2.html cgroup-tools 支持 cgroup v2 https://github.com/libcgroup/libcgroup/issues/12 https://askubuntu.com/questions/1406329/how-to-run-cgexec-without-sudo-as-current-user-on-ubuntu-22-04-with-cgroups-v2 https://www.cnblogs.com/sparkdev/p/8296063.html https://cizixs.com/2017/08/25/linux-cgroup/ ","wordCount":"634","inLanguage":"en","image":"https://runzhen.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2023-03-22T00:00:00Z","dateModified":"2023-03-22T00:00:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://runzhen.github.io/posts/cgroups-intro/"},"publisher":{"@type":"Organization","name":"Mind in the Wind","logo":{"@type":"ImageObject","url":"https://runzhen.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://runzhen.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://runzhen.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://runzhen.github.io/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://runzhen.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://runzhen.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://runzhen.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">What is cgroups ?</h1><div class=post-meta><span title='2023-03-22 00:00:00 +0000 UTC'>2023-03-22</span>&nbsp;·&nbsp;Me</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e7%9b%b4%e6%8e%a5%e4%bd%bf%e7%94%a8-cgroup aria-label="直接使用 cgroup">直接使用 cgroup</a></li><li><a href=#%e4%bd%bf%e7%94%a8-cgroup-tools aria-label="使用 cgroup-tools">使用 cgroup-tools</a><ul><li><a href=#%e4%be%8b-1---%e9%99%90%e5%88%b6%e8%bf%9b%e7%a8%8b%e5%8f%af%e7%94%a8%e7%9a%84-cpu-%e6%97%b6%e9%97%b4 aria-label="例 1 - 限制进程可用的 CPU 时间">例 1 - 限制进程可用的 CPU 时间</a></li><li><a href=#%e4%be%8b-2---%e9%99%90%e5%88%b6%e8%bf%9b%e7%a8%8b%e5%8f%af%e7%94%a8%e7%9a%84%e6%9c%80%e5%a4%a7%e5%86%85%e5%ad%98 aria-label="例 2 - 限制进程可用的最大内存">例 2 - 限制进程可用的最大内存</a></li></ul></li><li><a href=#%e9%99%84%e5%bd%95 aria-label=附录>附录</a><ul><ul><li><a href=#%e5%ad%90%e8%b5%84%e6%ba%90%e7%b3%bb%e7%bb%9fresource-classes-or-subsystem aria-label="子资源系统（Resource Classes or SubSystem）">子资源系统（Resource Classes or SubSystem）</a></li></ul></ul></li><li><a href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99 aria-label=参考资料>参考资料</a></li></ul></div></details></div><div class=post-content><p>cgroup 比较有趣的地方是它没有提供任何的系统调用接口，所以你不能用 API Call 的方式使用 cgroup，实际上 cgroup 实现了 linux 虚拟文件系统 vfs，所以类似我们熟悉的 btfrs, ext4， 因此可以用类似文件系统的方式进行操作。</p><p>比如用 mount 命令看一下 linux 上挂载了哪些设备：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>#</span> <span class=nx>mount</span> <span class=o>-</span><span class=nx>t</span> <span class=nx>cgroup</span>
</span></span><span class=line><span class=cl><span class=err>/dev/sda2 on / type ext4 (rw,relatime)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>cgroup</span> <span class=nx>on</span> <span class=o>/</span><span class=nx>sys</span><span class=o>/</span><span class=nx>fs</span><span class=o>/</span><span class=nx>cgroup</span><span class=o>/</span><span class=nx>systemd</span> <span class=nx>type</span> <span class=nx>cgroup</span> <span class=p>(</span><span class=nx>rw</span><span class=p>,</span><span class=nx>nosuid</span><span class=p>,</span><span class=nx>nodev</span><span class=p>,</span><span class=nx>noexec</span><span class=p>,</span><span class=nx>relatime</span><span class=p>,</span><span class=nx>xattr</span><span class=p>,</span><span class=nx>name</span><span class=o>=</span><span class=nx>systemd</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>cgroup</span> <span class=nx>on</span> <span class=o>/</span><span class=nx>sys</span><span class=o>/</span><span class=nx>fs</span><span class=o>/</span><span class=nx>cgroup</span><span class=o>/</span><span class=nx>net_cls</span><span class=p>,</span><span class=nx>net_prio</span> <span class=nx>type</span> <span class=nx>cgroup</span> <span class=p>(</span><span class=nx>rw</span><span class=p>,</span><span class=nx>nosuid</span><span class=p>,</span><span class=nx>nodev</span><span class=p>,</span><span class=nx>noexec</span><span class=p>,</span><span class=nx>relatime</span><span class=p>,</span><span class=nx>net_cls</span><span class=p>,</span><span class=nx>net_prio</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>cgroup</span> <span class=nx>on</span> <span class=o>/</span><span class=nx>sys</span><span class=o>/</span><span class=nx>fs</span><span class=o>/</span><span class=nx>cgroup</span><span class=o>/</span><span class=nx>rdma</span> <span class=nx>type</span> <span class=nx>cgroup</span> <span class=p>(</span><span class=nx>rw</span><span class=p>,</span><span class=nx>nosuid</span><span class=p>,</span><span class=nx>nodev</span><span class=p>,</span><span class=nx>noexec</span><span class=p>,</span><span class=nx>relatime</span><span class=p>,</span><span class=nx>rdma</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>cgroup2</span> <span class=nx>on</span> <span class=o>/</span><span class=nx>sys</span><span class=o>/</span><span class=nx>fs</span><span class=o>/</span><span class=nx>cgroup</span> <span class=nx>type</span> <span class=nx>cgroup2</span> <span class=p>(</span><span class=nx>rw</span><span class=p>,</span><span class=nx>nosuid</span><span class=p>,</span><span class=nx>nodev</span><span class=p>,</span><span class=nx>noexec</span><span class=p>,</span><span class=nx>relatime</span><span class=p>,</span><span class=nx>nsdelegate</span><span class=p>,</span><span class=nx>memory_recursiveprot</span><span class=p>)</span>
</span></span></code></pre></div><p>可以看到，</p><ul><li>第一行是磁盘 sda2 挂载在根目录 <code>/</code>, 它的类型是 ext4</li><li>后面几行是 cgroup 挂载在了目录 <code>/sys/fs/cgroup/</code>，类型是 cgroup</li><li>如果你的内核比较新的话，将看不到上面那些 cgroup 的行，而是只能看到最后这一行 <strong>cgroup2</strong>，这是因为新版本的内核使用了 cgroup v2 。</li></ul><p>另外类似于 “net_cls”， “rdma” 这些都是 cgroup 子系统的名字，详见本文结尾的附录。</p><p>知道了上面这些，那么我们就能用操作文件系统的方式使用 cgroup 了，正好我有两台 linux VM，</p><ul><li>一个 Ubuntu Server 22.04，内核 5.15， 默认使用了 cgroup v2</li><li>另一个是 Ubuntu Server 20.04, 内核 5.4，使用 cgroup v1</li></ul><p>cgroup 和 cgroup2 有很多不一样的地方，具体见参考资料 1。本文所有例子都基于 cgroup v2。</p><h1 id=直接使用-cgroup>直接使用 cgroup<a hidden class=anchor aria-hidden=true href=#直接使用-cgroup>#</a></h1><p>既然 cgroup 实现了 VFS，那么就能用 mkdir 创建一个目录，比如</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>#</span> <span class=nx>cd</span> <span class=o>/</span><span class=nx>sys</span><span class=o>/</span><span class=nx>fs</span><span class=o>/</span><span class=nx>cgroup</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>mkdir</span> <span class=nx>test</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>ls</span> <span class=nx>test</span> 
</span></span><span class=line><span class=cl><span class=nx>cgroup</span><span class=p>.</span><span class=nx>controllers</span>      <span class=nx>cgroup</span><span class=p>.</span><span class=nx>type</span>            <span class=nx>cpu</span><span class=p>.</span><span class=nx>stat</span>                  <span class=nx>hugetlb</span><span class=mf>.1</span><span class=nx>GB</span><span class=p>.</span><span class=nx>rsvd</span><span class=p>.</span><span class=nx>max</span>      <span class=nx>io</span><span class=p>.</span><span class=nx>stat</span>              <span class=nx>memory</span><span class=p>.</span><span class=nx>oom</span><span class=p>.</span><span class=nx>group</span>     <span class=nx>pids</span><span class=p>.</span><span class=nx>events</span>
</span></span><span class=line><span class=cl><span class=nx>cgroup</span><span class=p>.</span><span class=nx>events</span>           <span class=nx>cpu</span><span class=p>.</span><span class=nx>idle</span>               <span class=nx>cpu</span><span class=p>.</span><span class=nx>uclamp</span><span class=p>.</span><span class=nx>max</span>            <span class=nx>hugetlb</span><span class=mf>.2</span><span class=nx>MB</span><span class=p>.</span><span class=nx>current</span>       <span class=nx>io</span><span class=p>.</span><span class=nx>weight</span>            <span class=nx>memory</span><span class=p>.</span><span class=nx>pressure</span>      <span class=nx>pids</span><span class=p>.</span><span class=nx>max</span>
</span></span><span class=line><span class=cl><span class=nx>cgroup</span><span class=p>.</span><span class=nx>freeze</span>           <span class=nx>cpu</span><span class=p>.</span><span class=nx>max</span>                <span class=nx>cpu</span><span class=p>.</span><span class=nx>uclamp</span><span class=p>.</span><span class=nx>min</span>            <span class=nx>hugetlb</span><span class=mf>.2</span><span class=nx>MB</span><span class=p>.</span><span class=nx>events</span>        <span class=nx>memory</span><span class=p>.</span><span class=nx>current</span>       <span class=nx>memory</span><span class=p>.</span><span class=nx>stat</span>          <span class=nx>rdma</span><span class=p>.</span><span class=nx>current</span>
</span></span><span class=line><span class=cl><span class=nx>cgroup</span><span class=p>.</span><span class=nx>kill</span>             <span class=nx>cpu</span><span class=p>.</span><span class=nx>max</span><span class=p>.</span><span class=nx>burst</span>
</span></span></code></pre></div><ol><li>cgroup.controllers：这个文件显示了当前cgoup可以限制的相关资源有哪些。</li><li>cpu.max 限制了最大可用的 cpu 时间。<ol><li>在 cgroup v1 中可以设置 <code>cpu.cfs_quota_us</code> 和 <code>cpu.cfs_period_us</code> 的值来限制 cpu 使用率，参考资料里大多是用的 v1。</li><li>到了 cgroup v2 我们需要在 cpu.max 文件中写入这两个值。后面还会提到。</li></ol></li></ol><p>如果要设置某个 cgroup 的参数就是直接往对应的文件中写入特定格式的内容，比如要限制 cgroup 能够使用的 CPU 核数：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>#</span> <span class=nx>echo</span> <span class=mi>0</span><span class=o>-</span><span class=mi>1</span> <span class=o>&gt;</span> <span class=err>/sys/fs/cgroup/test/cpuset.cpus</span>
</span></span></code></pre></div><p>如果要用 “test” group 限制某个进程，只要把这个进程 PID 写入 cgroup.procs 文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=c1>// $$ 表示当前 bash 的 PID，
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>$</span> <span class=nx>echo</span> <span class=nx>$$</span> <span class=o>|</span> <span class=nx>sudo</span> <span class=nx>tee</span> <span class=o>/</span><span class=nx>sys</span><span class=o>/</span><span class=nx>fs</span><span class=o>/</span><span class=nx>cgroup</span><span class=o>/</span><span class=nx>test</span><span class=o>/</span><span class=nx>cgroup</span><span class=p>.</span><span class=nx>procs</span>
</span></span><span class=line><span class=cl><span class=mi>25982</span>
</span></span></code></pre></div><p>上面这个例子的结果就是所有在当前 bash 创建的进程都会收到 cgroup “test” 的限制。</p><p>显然，这样直接的方式很不方便，因此就有了 cgroup-tools。</p><h1 id=使用-cgroup-tools>使用 cgroup-tools<a hidden class=anchor aria-hidden=true href=#使用-cgroup-tools>#</a></h1><p>在 ubuntu 系统中可以用下面这个命令安装</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=nx>sudo</span> <span class=nx>apt</span><span class=o>-</span><span class=nx>get</span> <span class=nx>install</span> <span class=o>-</span><span class=nx>y</span> <span class=nx>cgroup</span><span class=o>-</span><span class=nx>tools</span>
</span></span></code></pre></div><p>新版本的 tools 也加入了对 <a href=https://github.com/libcgroup/libcgroup/issues/12>cgroup v2 的支持</a>。下面通过 2 个例子来熟悉一下使用方式。</p><h2 id=例-1---限制进程可用的-cpu-时间>例 1 - 限制进程可用的 CPU 时间<a hidden class=anchor aria-hidden=true href=#例-1---限制进程可用的-cpu-时间>#</a></h2><p>还是沿用上面已经创建好的名为 “test” 的 group。</p><p>首先确认一下 root group 里面的 cgroup.controllers 和 subtree_control 包含了 cpu，如果没有的话需要手动加上 “cpu”。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@loquat:/sys/fs/cgroup# cat cgroup.controllers
</span></span><span class=line><span class=cl>cpuset cpu io memory hugetlb pids rdma misc
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@loquat:/sys/fs/cgroup# cat cgroup.subtree_control
</span></span><span class=line><span class=cl>cpuset cpu io memory pids
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># test group 的 cgroup.controllers 与上层 subtree_control 保持一致</span>
</span></span><span class=line><span class=cl>root@loquat:/sys/fs/cgroup# cat test/cgroup.controllers
</span></span><span class=line><span class=cl>cpuset cpu io memory pids
</span></span></code></pre></div><p>再在 cpu.max 中写入</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@loquat:/sys/fs/cgroup# cat test/cpu.max
</span></span><span class=line><span class=cl><span class=m>10000</span> <span class=m>100000</span>
</span></span></code></pre></div><p>其含义是在linux CFS 进程调度的周期 1000000 us (也就是 100ms) 内，使用 10000 us (10 ms)。</p><p>再写一个程序循环很多次</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>void main<span class=o>(){</span>
</span></span><span class=line><span class=cl>    unsigned int i, end<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>end</span> <span class=o>=</span> <span class=m>1024</span> * <span class=m>1024</span> * 1024<span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=o>(</span><span class=nv>i</span> <span class=o>=</span> 0<span class=p>;</span> i &lt; end<span class=p>;</span> <span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        i ++<span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>结果：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@loquat:/home/runzhen/code/cgroups# <span class=nb>time</span> ./cputime
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>real	0m1.937s
</span></span><span class=line><span class=cl>user	0m1.937s
</span></span><span class=line><span class=cl>sys	0m0.000s
</span></span><span class=line><span class=cl>root@loquat:/home/runzhen/code/cgroups# <span class=nb>time</span> cgexec -g cpu:test ./cputime
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>real	0m19.560s
</span></span><span class=line><span class=cl>user	0m1.975s
</span></span><span class=line><span class=cl>sys	0m0.000s
</span></span></code></pre></div><p>其中 user 表示的就是用户感知的时间，可见，当没有 cgroup 限制时大约 1.9 秒就结束了，当有 cgroup 限制时用了 19 秒，<strong>十倍的差距，符合我们之前设定的值</strong>。</p><h2 id=例-2---限制进程可用的最大内存>例 2 - 限制进程可用的最大内存<a hidden class=anchor aria-hidden=true href=#例-2---限制进程可用的最大内存>#</a></h2><p>类似的，再 memory 相关文件中写入值。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@loquat:/sys/fs/cgroup/test# cat memory.max
</span></span><span class=line><span class=cl><span class=m>5242880</span>
</span></span><span class=line><span class=cl>root@loquat:/sys/fs/cgroup/test# cat memory.swap.max
</span></span><span class=line><span class=cl><span class=m>0</span>
</span></span></code></pre></div><ol><li><p>memory.max 中<strong>值的单位是 “bytes”</strong>，因此 5242880 表示最大使用 500MB 内存。</p></li><li><p>另外需要注意的是关闭 swap，设置为 0</p></li></ol><p>测试程序如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#include&lt;stdio.h&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#include&lt;stdlib.h&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>#include&lt;string.h&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#define CHUNK_SIZE 1024 * 1024 * 100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>void main<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    char *p<span class=p>;</span>
</span></span><span class=line><span class=cl>    int i<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=o>(</span><span class=nv>i</span> <span class=o>=</span> 0<span class=p>;</span> i &lt; 5<span class=p>;</span> i ++<span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>p</span> <span class=o>=</span> malloc<span class=o>(</span>sizeof<span class=o>(</span>char<span class=o>)</span> * CHUNK_SIZE<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(</span><span class=nv>p</span> <span class=o>==</span> NULL<span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>{</span>
</span></span><span class=line><span class=cl>            printf<span class=o>(</span><span class=s2>&#34;fail to malloc!&#34;</span><span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        memset<span class=o>(</span>p, 0, CHUNK_SIZE<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        printf<span class=o>(</span><span class=s2>&#34;malloc memory %d MB\n&#34;</span>, <span class=o>(</span>i + 1<span class=o>)</span> * 100<span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>运行结果</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@loquat:/home/runzhen/code/cgroups# ./mem
</span></span><span class=line><span class=cl>malloc memory <span class=m>100</span> MB
</span></span><span class=line><span class=cl>malloc memory <span class=m>200</span> MB
</span></span><span class=line><span class=cl>malloc memory <span class=m>300</span> MB
</span></span><span class=line><span class=cl>malloc memory <span class=m>400</span> MB
</span></span><span class=line><span class=cl>malloc memory <span class=m>500</span> MB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@loquat:/home/runzhen/code/cgroups# cgexec -g memory:test ./mem
</span></span><span class=line><span class=cl>Killed
</span></span></code></pre></div><p>测试程序因为 OOM 被 kill 了。</p><p>使用 stress 测试工具也能看到进程被 SIGKILL signal 9 了。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># cgexec -g memory:test stress --vm 1 --vm-bytes 500000000 --vm-keep --verbose</span>
</span></span><span class=line><span class=cl>stress: info: <span class=o>[</span>2684<span class=o>]</span> dispatching hogs: <span class=m>0</span> cpu, <span class=m>0</span> io, <span class=m>1</span> vm, <span class=m>0</span> hdd
</span></span><span class=line><span class=cl>stress: dbug: <span class=o>[</span>2684<span class=o>]</span> using backoff sleep of 3000us
</span></span><span class=line><span class=cl>stress: dbug: <span class=o>[</span>2684<span class=o>]</span> --&gt; hogvm worker <span class=m>1</span> <span class=o>[</span>2685<span class=o>]</span> forked
</span></span><span class=line><span class=cl>stress: dbug: <span class=o>[</span>2685<span class=o>]</span> allocating <span class=m>500000000</span> bytes ...
</span></span><span class=line><span class=cl>stress: dbug: <span class=o>[</span>2685<span class=o>]</span> touching bytes in strides of <span class=m>4096</span> bytes ...
</span></span><span class=line><span class=cl>stress: FAIL: <span class=o>[</span>2684<span class=o>]</span> <span class=o>(</span>416<span class=o>)</span> &lt;-- worker <span class=m>2685</span> got signal <span class=m>9</span>
</span></span><span class=line><span class=cl>stress: WARN: <span class=o>[</span>2684<span class=o>]</span> <span class=o>(</span>418<span class=o>)</span> now reaping child worker processes
</span></span><span class=line><span class=cl>stress: FAIL: <span class=o>[</span>2684<span class=o>]</span> <span class=o>(</span>452<span class=o>)</span> failed run completed in 0s
</span></span></code></pre></div><h1 id=附录>附录<a hidden class=anchor aria-hidden=true href=#附录>#</a></h1><h3 id=子资源系统resource-classes-or-subsystem>子资源系统（Resource Classes or SubSystem）<a hidden class=anchor aria-hidden=true href=#子资源系统resource-classes-or-subsystem>#</a></h3><p>目前有下面这些资源子系统：</p><ul><li>Block IO（<code>blkio</code>)：限制块设备（磁盘、SSD、USB 等）的 IO 速率</li><li>CPU Set(<code>cpuset</code>)：限制任务能运行在哪些 CPU 核上</li><li>CPU Accounting(<code>cpuacct</code>)：生成 cgroup 中任务使用 CPU 的报告</li><li>CPU (<code>CPU</code>)：限制调度器分配的 CPU 时间</li><li>Devices (<code>devices</code>)：允许或者拒绝 cgroup 中任务对设备的访问</li><li>Freezer (<code>freezer</code>)：挂起或者重启 cgroup 中的任务</li><li>Memory (<code>memory</code>)：限制 cgroup 中任务使用内存的量，并生成任务当前内存的使用情况报告</li><li>Network Classifier(<code>net_cls</code>)：为 cgroup 中的报文设置上特定的 classid 标志，这样 tc 等工具就能根据标记对网络进行配置</li><li>Network Priority (<code>net_prio</code>)：对每个网络接口设置报文的优先级</li><li><code>perf_event</code>：识别任务的 cgroup 成员，可以用来做性能分析</li></ul><h1 id=参考资料>参考资料<a hidden class=anchor aria-hidden=true href=#参考资料>#</a></h1><ol><li><a href=https://adtxl.com/index.php/archives/179.html>https://adtxl.com/index.php/archives/179.html</a></li><li><a href=https://zorrozou.github.io/docs/%E8%AF%A6%E8%A7%A3Cgroup%20V2.html>https://zorrozou.github.io/docs/详解Cgroup V2.html</a></li><li>cgroup-tools 支持 cgroup v2 <a href=https://github.com/libcgroup/libcgroup/issues/12>https://github.com/libcgroup/libcgroup/issues/12</a></li><li><a href=https://askubuntu.com/questions/1406329/how-to-run-cgexec-without-sudo-as-current-user-on-ubuntu-22-04-with-cgroups-v2>https://askubuntu.com/questions/1406329/how-to-run-cgexec-without-sudo-as-current-user-on-ubuntu-22-04-with-cgroups-v2</a></li><li><a href=https://www.cnblogs.com/sparkdev/p/8296063.html>https://www.cnblogs.com/sparkdev/p/8296063.html</a></li><li><a href=https://cizixs.com/2017/08/25/linux-cgroup/>https://cizixs.com/2017/08/25/linux-cgroup/</a></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://runzhen.github.io/tags/linux/>Linux</a></li></ul><nav class=paginav><a class=prev href=https://runzhen.github.io/posts/go-maxprocs/><span class=title>« Prev</span><br><span>Set GOMAXPROCS Properly in Go Program</span>
</a><a class=next href=https://runzhen.github.io/posts/boltdb-b-plus-tree/><span class=title>Next »</span><br><span>B+ Tree Implementation in boltdb</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share What is cgroups ? on x" href="https://x.com/intent/tweet/?text=What%20is%20cgroups%20%3f&amp;url=https%3a%2f%2frunzhen.github.io%2fposts%2fcgroups-intro%2f&amp;hashtags=linux"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share What is cgroups ? on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frunzhen.github.io%2fposts%2fcgroups-intro%2f&amp;title=What%20is%20cgroups%20%3f&amp;summary=What%20is%20cgroups%20%3f&amp;source=https%3a%2f%2frunzhen.github.io%2fposts%2fcgroups-intro%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share What is cgroups ? on reddit" href="https://reddit.com/submit?url=https%3a%2f%2frunzhen.github.io%2fposts%2fcgroups-intro%2f&title=What%20is%20cgroups%20%3f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share What is cgroups ? on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frunzhen.github.io%2fposts%2fcgroups-intro%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share What is cgroups ? on whatsapp" href="https://api.whatsapp.com/send?text=What%20is%20cgroups%20%3f%20-%20https%3a%2f%2frunzhen.github.io%2fposts%2fcgroups-intro%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share What is cgroups ? on telegram" href="https://telegram.me/share/url?text=What%20is%20cgroups%20%3f&amp;url=https%3a%2f%2frunzhen.github.io%2fposts%2fcgroups-intro%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share What is cgroups ? on ycombinator" href="https://news.ycombinator.com/submitlink?t=What%20is%20cgroups%20%3f&u=https%3a%2f%2frunzhen.github.io%2fposts%2fcgroups-intro%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://runzhen.github.io/>Mind in the Wind</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>